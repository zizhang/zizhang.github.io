<!DOCTYPE html>
<html>
<head>
<title>Traction on Demand SFMC POC</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script type="text/javascript">
$( document ).ready(function() {
    console.log("Ready!");
    var j = getUrlParameter('j');
	var e = getUrlParameter('e');
	var l = getUrlParameter('l');
	var u = getUrlParameter('u');
	var jb = getUrlParameter('jb');
	var mid = getUrlParameter('mid');

	$('#container').append('<p>j = ' + j + '</p>');
	$('#container').append('<p>e = ' + e + '</p>');
	$('#container').append('<p>l = ' + l + '</p>');
	$('#container').append('<p>u = ' + u + '</p>');
	$('#container').append('<p>jb = ' + jb + '</p>');
	$('#container').append('<p>mid = ' + mid + '</p>');

	var xmlString = constructXMLString(j, e, l, u, jb, mid, 100);

	$('#container').append('<p id="xmlContainer"></p>');
	$('#xmlContainer').text(xmlString);


	var imgTag = 'http://click.s7.exacttarget.com/conversion.aspx?xml=' + xmlString;
	console.log(xmlString.length);
	if(xmlString.length > 0) {
		console.log('Img tag added');
		$('#container').append('<img src="' + + '" width="1" height="1" />');
	}

});

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};

function constructXMLString(jobId, emailAddr, listId, urlId, jobBatchId, memberId, dollarAmount) {
	var resultXML = '';
	console.log(jobId, emailAddr, listId, urlId, jobBatchId, memberId, dollarAmount);
	if(jobId != null && emailAddr != null && listId != null && urlId != null && jobBatchId != null && memberId != null && dollarAmount != null) {
		resultXML += '<system><system_name>tracking</system_name><action>conversion</action>';
		resultXML += '<member_id>' + memberId + '</member_id>';
		resultXML += '<job_id>' + jobId + '</job_id>';
		resultXML += '<email>' + emailAddr + '</email>';
		resultXML += '<list>' + listId + '</list>';
		resultXML += '<original_link_id>' + urlId + '</original_link_id>';
		resultXML += '<BatchID>' + jobBatchId + '</BatchID>';
		resultXML += '<conversion_link_id>1</conversion_link_id>';
		resultXML += '<link_alias>Wine Bottle 1</link_alias>';
		resultXML += '<link_alias>3</link_alias>';
		resultXML += '<data_set><data amt="' + dollarAmount + '" unit="Dollars" accumulate="true"/>';
		resultXML += '</data_set></system>';
	}

	return resultXML;
}

</script>
</head>
<body>
<h1>Traction on Demand SFMC POC</h1>
<div id="container"></div>
</body>
</html>